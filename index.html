<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#1a1612" />
        <meta name="description" content="Organize tennis sessions, create balanced teams, and track matchups with your friends." />
        <title>Court Shuffle — Tennis Session Manager</title>
    
        <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="favicon.svg" />
        <link rel="shortcut icon" href="favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
        <link rel="manifest" href="site.webmanifest" />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

        <link rel="stylesheet" href="css/main.css" />
    </head>
    <body>
        <div id="app">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="topbar-brand">
                    <div class="brand-icon">
                        <svg viewBox="0 0 32 32" fill="none" aria-hidden="true">
                            <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2.5" />
                            <path d="M5 16C5 16 12 8 27 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M5 27C5 27 20 24 27 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <line x1="16" y1="2" x2="16" y2="30" stroke="currentColor" stroke-width="1.5" />
                        </svg>
                    </div>
                    <span class="brand-name">Court Shuffle</span>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="tabs" role="tablist">
                <button type="button" class="tab active" role="tab" data-view="roster" aria-selected="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    <span>Roster</span>
                </button>
                <button type="button" class="tab" role="tab" data-view="session" aria-selected="false">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <span>Session</span>
                </button>
                <button type="button" class="tab" role="tab" data-view="history" aria-selected="false">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                    </svg>
                    <span>History</span>
                </button>
                <button type="button" class="tab" role="tab" data-view="stats" aria-selected="false">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                        <path d="M4 19h16" />
                        <path d="M7 15V11" />
                        <path d="M12 15V6" />
                        <path d="M17 15V9" />
                        <circle cx="17" cy="7" r="2" />
                    </svg>
                    <span>Stats</span>
                </button>
            </nav>

            <!-- Views Container -->
            <main class="views">
                <!-- ROSTER VIEW -->
                <section id="view-roster" class="view active" role="tabpanel">
                    <div class="view-header">
                        <h1>Your Roster</h1>
                        <p>Manage the players available for your sessions.</p>
                    </div>

                    <div class="add-player-form">
                        <input type="text" id="player-name-input" placeholder="Player name…" autocomplete="off" maxlength="30" />
                        <button type="button" id="add-player-btn" class="btn btn-primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            Add
                        </button>
                    </div>
                    <div id="player-error" class="field-error" hidden></div>

                    <div id="roster-list" class="roster-list">
                        <!-- Populated by JS -->
                    </div>

                    <div id="roster-empty" class="empty-state">
                        <div class="empty-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" aria-hidden="true">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <line x1="19" y1="8" x2="19" y2="14" />
                                <line x1="22" y1="11" x2="16" y2="11" />
                            </svg>
                        </div>
                        <p>No players yet</p>
                        <span>Add your tennis crew to get started</span>
                    </div>
                </section>

                <!-- SESSION VIEW -->
                <section id="view-session" class="view" role="tabpanel">
                    <!-- Phase 1: Setup -->
                    <div id="session-setup" class="session-phase">
                        <div class="view-header">
                            <h1>New Session</h1>
                            <p>Pick who's playing today and configure teams.</p>
                        </div>

                        <div id="no-roster-warning" class="warning-banner" hidden>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                            <span>Add at least 2 players to your roster first.</span>
                        </div>

                        <div id="session-config" class="session-config">
                            <h2 class="section-label">Select Players</h2>
                            <div class="select-actions">
                                <button type="button" id="select-all-btn" class="btn btn-ghost btn-sm">Select All</button>
                                <button type="button" id="deselect-all-btn" class="btn btn-ghost btn-sm">Deselect All</button>
                            </div>
                            <div id="player-selection" class="player-selection-grid">
                                <!-- Populated by JS -->
                            </div>

                            <div class="config-group">
                                <h2 class="section-label">Mode</h2>
                                <div id="mode-selector" class="mode-selector mode-selector-2">
                                    <button type="button" class="mode-btn selected" data-mode="free">Free</button>
                                    <button type="button" class="mode-btn" data-mode="tournament">Tournament</button>
                                </div>
                                <div id="mode-hint" class="hint"></div>
                            </div>

                            <div id="tournament-config" class="config-group tournament-settings" hidden>
                                <div class="tournament-settings-header">
                                    <span class="tournament-settings-badge">Tournament Settings</span>
                                </div>
                                <h2 class="section-label">Format</h2>
                                <div id="format-selector" class="mode-selector">
                                    <button type="button" class="format-btn mode-btn selected" data-format="consolation">Consolation</button>
                                    <button type="button" class="format-btn mode-btn" data-format="elimination">Elimination</button>
                                    <button type="button" class="format-btn mode-btn" data-format="round-robin">Round Robin</button>
                                </div>

                                <h2 class="section-label">Match Type</h2>
                                <div id="tournament-team-size" class="mode-selector mode-selector-2">
                                    <button type="button" class="team-size-btn mode-btn selected" data-team-size="1">Singles (1v1)</button>
                                    <button type="button" class="team-size-btn mode-btn" data-team-size="2">Doubles (2v2)</button>
                                </div>

                                <div id="tournament-hint" class="hint"></div>
                            </div>

                            <div id="courts-config" class="config-group" hidden>
                                <h2 class="section-label">Courts</h2>
                                <div class="team-count-control">
                                    <button type="button" id="courts-dec" class="btn btn-icon" aria-label="Decrease courts">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12" /></svg>
                                    </button>
                                    <div class="team-count-display">
                                        <span id="court-count-value">1</span>
                                        <small>courts</small>
                                    </div>
                                    <button type="button" id="courts-inc" class="btn btn-icon" aria-label="Increase courts">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
                                    </button>
                                </div>
                                <div id="court-hint" class="hint"></div>
                            </div>

                            <div id="not-strict-doubles" class="config-group" hidden>
                                <label class="toggle-row" for="allow-2v1">
                                    <span class="toggle-switch">
                                        <input type="checkbox" id="allow-2v1" />
                                        <span class="toggle-track"></span>
                                    </span>
                                    <span class="toggle-label">Allow 2v1 matchups</span>
                                </label>
                                <div class="hint">Lets courts run with 3 players instead of requiring 4.</div>
                            </div>

                            <div id="teams-config" class="config-group">
                                <h2 class="section-label">Teams</h2>
                                <div class="team-count-control">
                                    <button type="button" id="teams-dec" class="btn btn-icon" aria-label="Decrease teams">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><line x1="5" y1="12" x2="19" y2="12" /></svg>
                                    </button>
                                    <div class="team-count-display">
                                        <span id="team-count-value">2</span>
                                        <small>teams</small>
                                    </div>
                                    <button type="button" id="teams-inc" class="btn btn-icon" aria-label="Increase teams">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
                                    </button>
                                </div>
                                <div id="team-size-hint" class="hint"></div>
                            </div>

                            <button type="button" id="start-session-btn" class="btn btn-accent btn-lg btn-full" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                                    <polyline points="16 3 21 3 21 8" />
                                    <line x1="4" y1="20" x2="21" y2="3" />
                                    <polyline points="21 16 21 21 16 21" />
                                    <line x1="15" y1="15" x2="21" y2="21" />
                                    <line x1="4" y1="4" x2="9" y2="9" />
                                </svg>
                                Shuffle &amp; Start
                            </button>
                        </div>
                    </div>

                    <!-- Phase 2: Active Session -->
                    <div id="session-active" class="session-phase" hidden>
                        <div class="session-topbar">
                            <div>
                                <h1 id="session-title"><span id="round-prefix">Round </span><span id="round-number">1</span> <span class="round-of">of <span id="round-total">1</span></span></h1>
                                <p id="round-info" class="session-subtitle"></p>
                            </div>
                            <div class="session-actions">
                                <button type="button" id="prev-round-btn" class="btn btn-ghost btn-sm">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
                                        <polyline points="15 18 9 12 15 6" />
                                    </svg>
                                    Prev Round
                                </button>
                                <button type="button" id="next-round-btn" class="btn btn-primary btn-sm">
                                    <span id="next-round-label">Next Round</span>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><polyline points="9 18 15 12 9 6" /></svg>
                                </button>
                                <button type="button" id="end-session-btn" class="btn btn-ghost btn-sm btn-danger">End Session</button>
                            </div>
                        </div>

                        <div id="tournament-series-nav" class="tournament-series-nav" hidden>
                            <div class="tournament-series-nav-meta">
                                <span class="tournament-series-nav-label">Mini Tournament</span>
                                <div class="tournament-series-nav-meta-right">
                                    <span id="tournament-series-nav-status" class="tournament-series-nav-status"></span>
                                    <button
                                        type="button"
                                        id="tournament-series-nav-toggle"
                                        class="btn btn-ghost btn-sm tournament-series-nav-toggle"
                                        aria-label="Collapse mini tournament controls"
                                        title="Collapse"
                                        aria-expanded="true"
                                        aria-controls="tournament-series-nav-actions"
                                    >
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                            <polyline points="18 15 12 9 6 15" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="tournament-series-nav-actions" class="tournament-series-nav-actions">
                                <button type="button" id="prev-tournament-btn" class="btn btn-ghost btn-sm">Previous Tournament</button>
                                <button type="button" id="skip-tournament-btn" class="btn btn-ghost btn-sm btn-danger">Skip Tournament</button>
                                <button type="button" id="next-tournament-btn" class="btn btn-accent btn-sm">Next Tournament</button>
                            </div>
                        </div>

                        <div id="bracket-container" class="bracket-container">
                            <!-- Populated by JS -->
                        </div>

                        <div id="sit-out-container" class="sit-out-container" hidden>
                            <h3 class="section-label">Sitting Out</h3>
                            <div id="sit-out-list" class="sit-out-list"></div>
                        </div>

                        <div id="no-more-rounds" class="info-banner" hidden>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                <polyline points="22 4 12 14.01 9 11.01" />
                            </svg>
                            <span>That's all rounds for this session. End it or start a new one.</span>
                        </div>
                    </div>
                </section>

                <!-- HISTORY VIEW -->
                <section id="view-history" class="view" role="tabpanel">
                    <div class="view-header">
                        <h1>Session History</h1>
                        <p>Past sessions and their matchups.</p>
                    </div>

                    <div id="history-list" class="history-list">
                        <!-- Populated by JS -->
                    </div>

                    <div id="history-empty" class="empty-state">
                        <div class="empty-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" aria-hidden="true">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                            </svg>
                        </div>
                        <p>No sessions yet</p>
                        <span>Completed sessions will appear here</span>
                    </div>
                </section>

                <!-- STATS VIEW -->
                <section id="view-stats" class="view" role="tabpanel">
                    <div id="stats-root">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </main>
        </div>

        <!-- Rename Modal -->
        <dialog id="rename-dialog" class="modal">
            <div class="modal-content">
                <h2>Rename Player</h2>
                <input type="text" id="rename-input" placeholder="New name…" maxlength="30" />
                <div id="rename-error" class="field-error" hidden></div>
                <div class="modal-actions">
                    <button type="button" id="rename-cancel" class="btn btn-ghost">Cancel</button>
                    <button type="button" id="rename-confirm" class="btn btn-primary">Rename</button>
                </div>
            </div>
        </dialog>

        <!-- Confirm Modal -->
        <dialog id="confirm-dialog" class="modal">
            <div class="modal-content">
                <h2 id="confirm-title">Are you sure?</h2>
                <p id="confirm-message"></p>
                <div class="modal-actions">
                    <button type="button" id="confirm-cancel" class="btn btn-ghost">Cancel</button>
                    <button type="button" id="confirm-extra" class="btn btn-ghost btn-danger" hidden>Discard</button>
                    <button type="button" id="confirm-ok" class="btn btn-danger">Confirm</button>
                </div>
            </div>
        </dialog>

        <script type="module" src="js/app.js"></script>
    </body>
</html>
